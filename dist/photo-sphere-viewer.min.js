/*!
 * Photo Sphere Viewer 3.1.0
 * Copyright (c) 2014-2015 Jérémy Heleine
 * Copyright (c) 2015-2016 Damien "Mistic" Sorel
 * Licensed under MIT (http://opensource.org/licenses/MIT)
 */

!function(a,b){"function"==typeof define&&define.amd?define(["three","D.js"],b):"object"==typeof module&&module.exports?module.exports=b(require("three"),require("d.js")):a.PhotoSphereViewer=b(a.THREE,a.D)}(this,function(a,b){"use strict";function c(a){if(!(this instanceof c))return new c(a);if(c.SYSTEM.loaded||c.loadSystem(),this.config=v.deepmerge(c.DEFAULTS,a),this.config.min_fov=v.stayBetween(this.config.min_fov,1,179),this.config.max_fov=v.stayBetween(this.config.max_fov,1,179),this.config.tilt_up_max=v.stayBetween(this.config.tilt_up_max,-c.HalfPI,c.HalfPI),this.config.tilt_down_max=v.stayBetween(this.config.tilt_down_max,-c.HalfPI,c.HalfPI),null===this.config.default_fov?this.config.default_fov=this.config.max_fov/2+this.config.min_fov/2:this.config.default_fov=v.stayBetween(this.config.default_fov,this.config.min_fov,this.config.max_fov),null===this.config.anim_lat&&(this.config.anim_lat=this.config.default_lat),this.config.anim_lat=v.stayBetween(this.config.anim_lat,-c.HalfPI,c.HalfPI),this.config.caption&&!this.config.navbar&&(this.config.navbar=["caption"]),!a.panorama||!a.container)throw new f("No value given for panorama or container.");if(!(c.SYSTEM.isWebGLSupported&&this.config.webgl||v.checkTHREE("CanvasRenderer","Projector")))throw new f("Missing Three.js components: CanvasRenderer, Projector. Get them from threejs-examples package.");if(this.config.transition&&this.config.transition.blur)if(c.SYSTEM.isWebGLSupported&&this.config.webgl){if(!v.checkTHREE("EffectComposer","RenderPass","ShaderPass","MaskPass","CopyShader"))throw new f("Missing Three.js components: EffectComposer, RenderPass, ShaderPass, MaskPass, CopyShader. Get them from threejs-examples package.")}else this.config.transition.blur=!1,console.warn("PhotoSphereViewer: Using canvas rendering, blur transition disabled.");if(this.config.max_fov<this.config.min_fov)throw new f("max_fov cannot be lower than min_fov.");if(this.config.tilt_up_max<this.config.tilt_down_max)throw new f("tilt_up_max cannot be lower than tilt_down_max.");if(this.parent="string"==typeof this.config.container?document.getElementById(this.config.container):this.config.container,this.container=null,this.loader=null,this.navbar=null,this.hud=null,this.panel=null,this.tooltip=null,this.canvas_container=null,this.renderer=null,this.composer=null,this.passes={},this.scene=null,this.camera=null,this.mesh=null,this.raycaster=null,this.doControls=null,this.actions={},this.prop={latitude:0,longitude:0,anim_speed:0,zoom_lvl:0,moving:!1,zooming:!1,editing:!1,start_mouse_x:0,start_mouse_y:0,mouse_x:0,mouse_y:0,mouse_history:[],pinch_dist:0,direction:null,orientation_reqid:null,autorotate_reqid:null,animation_promise:null,start_timeout:null,boundingRect:null,size:{width:0,height:0},image_size:{width:0,height:0,original_width:0,original_height:0},pano_data:{full_width:0,full_height:0,cropped_width:0,cropped_height:0,cropped_x:0,cropped_y:0}},this.prop.zoom_lvl=Math.round((this.config.default_fov-this.config.min_fov)/(this.config.max_fov-this.config.min_fov)*100),this.prop.zoom_lvl-=2*(this.prop.zoom_lvl-50),this.container=document.createElement("div"),this.container.classList.add("psv-container"),this.parent.appendChild(this.container),!c.SYSTEM.isCanvasSupported)throw this.container.textContent="Canvas is not supported, update your browser!",new f("Canvas is not supported.");this.setAnimSpeed(this.config.anim_speed),this.rotate({longitude:this.config.default_long,latitude:this.config.default_lat}),null!==this.config.size&&this._setViewerSize(this.config.size),this.config.autoload&&this.load()}function d(a){this.psv=a instanceof c?a:a.psv,this.parent=a,this.container=null,this.constructor.publicMethods&&this.constructor.publicMethods.forEach(function(a){this.psv[a]=this[a].bind(this)},this)}function e(a){d.call(this,a)}function f(a){this.message=a,"captureStackTrace"in Error?Error.captureStackTrace(this,f):this.stack=(new Error).stack}function g(a){e.call(this,a),this.create()}function h(a,b){e.call(this,a),this.config=b,this.create()}function i(a){e.call(this,a),this.create()}function j(a){e.call(this,a),this.create()}function k(a){e.call(this,a),this.create()}function l(a){e.call(this,a),this.prop={panelOpened:!1,panelOpening:!1},this.create()}function m(a){e.call(this,a),this.prop={panelOpened:!1,panelOpening:!1},this.create()}function n(a){e.call(this,a),this.zoom_range=null,this.zoom_value=null,this.prop={mousedown:!1,buttondown:!1,longPressInterval:null},this.create()}function o(a){d.call(this,a),this.$svg=null,this.markers={},this.currentMarker=null,this.hoveringMarker=null,this.create()}function p(a){d.call(this,a),this.canvas=null,this.loader=null,this.create()}function q(a){if(d.call(this,a),this.config=this.psv.config.navbar,this.items=[],this.config===!0)this.config=v.clone(c.DEFAULTS.navbar);else if("string"==typeof this.config)this.config=this.config.split(" ");else if(!Array.isArray(this.config)){console.warn('PhotoSphereViewer: hashmap form of "navbar" is deprecated, use an array instead.');var b=this.config;this.config=[];for(var e in b)b[e]&&this.config.push(e);this.config.sort(function(a,b){return c.DEFAULTS.navbar.indexOf(a)-c.DEFAULTS.navbar.indexOf(b)})}this.create()}function r(a,b){d.call(this,a),this.create(),this.setCaption(b)}function s(a,b){d.call(this,a),this.create(),this.container.classList.add("weight-"+(b||5))}function t(a){d.call(this,a),this.content=null,this.prop={mouse_x:0,mouse_y:0,mousedown:!1,opened:!1},this.create()}function u(a){d.call(this,a),this.config=this.psv.config.tooltip,this.create()}c.PI=Math.PI,c.TwoPI=2*Math.PI,c.HalfPI=Math.PI/2,c.MOVE_THRESHOLD=4,c.INERTIA_WINDOW=300,c.ICONS={},c.SYSTEM={loaded:!1,isWebGLSupported:!1,isCanvasSupported:!1,deviceOrientationSupported:null,maxTextureWidth:0,mouseWheelEvent:null,fullscreenEvent:null},c.DEFAULTS={panorama:null,container:null,caption:null,autoload:!0,usexmpdata:!0,webgl:!0,min_fov:30,max_fov:90,default_fov:null,default_long:0,default_lat:0,tilt_up_max:c.HalfPI,tilt_down_max:-c.HalfPI,long_offset:Math.PI/1440,lat_offset:Math.PI/720,time_anim:2e3,anim_speed:"2rpm",anim_lat:null,navbar:["autorotate","zoom","download","markers","caption","gyroscope","fullscreen"],tooltip:{offset:5,arrow_size:7,delay:100},lang:{autorotate:"Automatic rotation",zoom:"Zoom",zoomOut:"Zoom out",zoomIn:"Zoom in",download:"Download",fullscreen:"Fullscreen",markers:"Markers",gyroscope:"Gyroscope"},mousewheel:!0,mousemove:!0,move_inertia:!0,click_event_on_marker:!0,transition:{duration:1500,loader:!0,blur:!1},loading_img:null,loading_txt:"Loading...",size:null,markers:[]},d.prototype.create=function(){this.container=document.createElement("div"),this.constructor.className&&(this.container.className=this.constructor.className),this.parent.container.appendChild(this.container)},d.prototype.destroy=function(){this.parent.container.removeChild(this.container),this.container=null,this.psv=null,this.parent=null},e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.create=function(){d.prototype.create.call(this),this.constructor.icon&&(this.container.innerHTML=c.ICONS[this.constructor.icon])},e.prototype.toggleActive=function(a){this.container.classList.toggle("active",a),this.constructor.iconActive&&(this.container.innerHTML=c.ICONS[a?this.constructor.iconActive:this.constructor.icon])},f.prototype=Object.create(Error.prototype),f.prototype.name="PSVError",f.prototype.constructor=f;var v={};return v.checkTHREE=function(){for(var b=0,c=arguments.length;c>b;b++)if(!(arguments[b]in a))return!1;return!0},v.isCanvasSupported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},v.getWebGLCtx=function(){var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=null;return a.getContext&&b.some(function(b){try{return c=a.getContext(b),c&&"function"==typeof c.getParameter}catch(d){return!1}})?c:null},v.isWebGLSupported=function(){return!!window.WebGLRenderingContext&&null!==v.getWebGLCtx()},v.getMaxTextureWidth=function(){var a=v.getWebGLCtx();return a.getParameter(a.MAX_TEXTURE_SIZE)},v.hasParent=function(a,b){do if(a===b)return!0;while(a=a.parentNode);return!1},v.getClosest=function(a,b){var c=a.matches||a.msMatchesSelector;do if(c.bind(a)(b))return a;while(a=a.parentElement);return null},v.mouseWheelEvent=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},v.fullscreenEvent=function(){var a={exitFullscreen:"fullscreenchange",webkitExitFullscreen:"webkitfullscreenchange",mozCancelFullScreen:"mozfullscreenchange",msExitFullscreen:"msFullscreenEnabled"};for(var b in a)if(b in document)return a[b];return"fullscreenchange"},v.stayBetween=function(a,b,c){return Math.max(b,Math.min(c,a))},v.getXMPValue=function(a,b){var c,d;return-1!==(c=a.indexOf("<GPano:"+b+">"))&&-1!==(d=a.indexOf("</GPano:"+b+">"))?a.substring(c,d).replace("<GPano:"+b+">",""):-1!==(c=a.indexOf("GPano:"+b))&&-1!==(d=a.indexOf('"',c+b.length+8))?a.substring(c+b.length+8,d):null},v.isFullscreenEnabled=function(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},v.requestFullscreen=function(a){(a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen).call(a)},v.exitFullscreen=function(a){(document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document)},v.getStyle=function(a,b){return window.getComputedStyle(a,null)[b]},v.parsePosition=function(a){if(!a)return{top:.5,left:.5};if("object"==typeof a)return a;var b=a.toLocaleLowerCase().split(" ").slice(0,2);1===b.length&&(b=void 0!==v.parsePosition.positions[b[0]]?[b[0],"center"]:[b[0],b[0]]);var c="left"!=b[1]&&"right"!=b[1]&&"top"!=b[0]&&"bottom"!=b[0];b=b.map(function(a){return v.parsePosition.positions[a]||a}),c||b.reverse();var d=b.join(" ").match(/^([0-9.]+)% ([0-9.]+)%$/);return d?{left:d[1]/100,top:d[2]/100}:{top:.5,left:.5}},v.parsePosition.positions={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},v.animation=function(a){function c(b){if(-1!==d.promise.getStatus()){null===e&&(e=b);var f,g=(b-e)/a.duration,h={};if(1>g){for(f in a.properties)h[f]=a.properties[f].start+(a.properties[f].end-a.properties[f].start)*a.easing(g);a.onTick(h,g),window.requestAnimationFrame(c)}else{for(f in a.properties)h[f]=a.properties[f].end;a.onTick(h,1),d.resolve()}}}var d=b(),e=null;a.easing&&"string"!=typeof a.easing||(a.easing=v.animation.easings[a.easing||"linear"]),void 0!==a.delay?window.setTimeout(function(){window.requestAnimationFrame(c)},a.delay):window.requestAnimationFrame(c);var f=d.promise;return f.cancel=function(){a.onCancel&&(a.onCancel(),d.reject(d))},f},v.animation.easings={linear:function(a){return a},inQuad:function(a){return a*a},outQuad:function(a){return a*(2-a)},inOutQuad:function(a){return.5>a?2*a*a:-1+(4-2*a)*a},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*a*a+1},inOutCubic:function(a){return.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},inQuart:function(a){return a*a*a*a},outQuart:function(a){return 1- --a*a*a*a},inOutQuart:function(a){return.5>a?8*a*a*a*a:1-8*--a*a*a*a},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return 1+--a*a*a*a*a},inOutQuint:function(a){return.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a},inSine:function(a){return 1-Math.cos(a*(Math.PI/2))},outSine:function(a){return Math.sin(a*(Math.PI/2))},inOutSine:function(a){return.5-.5*Math.cos(Math.PI*a)},inExpo:function(a){return Math.pow(2,10*(a-1))},outExpo:function(a){return 1-Math.pow(2,-10*a)},inOutExpo:function(a){return a=2*a-1,0>a?.5*Math.pow(2,10*a):1-.5*Math.pow(2,-10*a)},inCirc:function(a){return 1-Math.sqrt(1-a*a)},outCirc:function(a){return a--,Math.sqrt(1-a*a)},inOutCirc:function(a){return a*=2,1>a?.5-.5*Math.sqrt(1-a*a):.5+.5*Math.sqrt(1-(a-=2)*a)}},v.throttle=function(a,b){var c,d,e,f=null,g=0,h=function(){g=Date.now(),f=null,e=a.apply(c,d),f||(c=d=null)};return function(){var i=Date.now();g||(g=i);var j=b-(i-g);return c=this,d=arguments,0>=j||j>b?(f&&(clearTimeout(f),f=null),g=i,e=a.apply(c,d),f||(c=d=null)):f||(f=setTimeout(h,j)),e}},v.deepmerge=function(a,b){var c=Array.isArray(b),d=c&&[]||{};return c?b.forEach(function(a,b){"undefined"==typeof d[b]?d[b]=a:d[b]=v.deepmerge(null,a)}):(a&&Array.isArray(a)&&(a=void 0),a&&"object"==typeof a&&Object.keys(a).forEach(function(b){d[b]=a[b]}),Object.keys(b).forEach(function(c){"object"==typeof b[c]&&b[c]&&a[c]?d[c]=v.deepmerge(a[c],b[c]):d[c]=b[c]})),d},v.clone=function(a){return v.deepmerge(Array.isArray(a)?[]:{},a)},c.prototype._loadXMP=function(){if(!this.config.usexmpdata)return b.resolved(null);var a=b(),c=new XMLHttpRequest,d=this,e=0;return c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status||201===c.status||202===c.status||0===c.status){d.loader&&d.loader.setProgress(100);var b=c.responseText,f=b.indexOf("<x:xmpmeta"),g=b.indexOf("</x:xmpmeta>"),h=b.substring(f,g);if(-1===f||-1===g||-1===h.indexOf("GPano:"))a.resolve(null);else{var i={full_width:parseInt(v.getXMPValue(h,"FullPanoWidthPixels")),full_height:parseInt(v.getXMPValue(h,"FullPanoHeightPixels")),cropped_width:parseInt(v.getXMPValue(h,"CroppedAreaImageWidthPixels")),cropped_height:parseInt(v.getXMPValue(h,"CroppedAreaImageHeightPixels")),cropped_x:parseInt(v.getXMPValue(h,"CroppedAreaLeftPixels")),cropped_y:parseInt(v.getXMPValue(h,"CroppedAreaTopPixels"))};a.resolve(i)}}else d.container.textContent="Cannot load image",a.reject();else 3===c.readyState&&d.loader&&d.loader.setProgress(e+10)},c.onprogress=function(a){if(a.lengthComputable&&d.loader){var b=parseInt(a.loaded/a.total*100);b>e&&(e=b,d.loader.setProgress(e))}},c.onerror=function(){d.container.textContent="Cannot load image",a.reject()},c.open("GET",this.config.panorama,!0),c.send(null),a.promise},c.prototype._loadTexture=function(d){var e=b(),f=new a.ImageLoader,g=this,h=d?100:0;this.config.panorama.match(/^data:image\/[a-z]+;base64/)||f.setCrossOrigin("anonymous");var i=function(b){g.loader&&g.loader.setProgress(100),d||(d={full_width:b.width,full_height:b.height,cropped_width:b.width,cropped_height:b.height,cropped_x:0,cropped_y:0}),g.prop.image_size.original_width=d.cropped_width,g.prop.image_size.original_height=d.cropped_height;var f=4096;c.SYSTEM.isWebGLSupported&&(f=c.SYSTEM.maxTextureWidth);var h=Math.min(d.full_width,f)/d.full_width;d.full_width*=h,d.full_height*=h,d.cropped_width*=h,d.cropped_height*=h,d.cropped_x*=h,d.cropped_y*=h,b.width=d.cropped_width,b.height=d.cropped_height,g.prop.image_size.width=d.cropped_width,g.prop.image_size.height=d.cropped_height,g.prop.pano_data=d;var i=document.createElement("canvas");i.width=d.full_width,i.height=d.full_height;var j=i.getContext("2d");j.drawImage(b,d.cropped_x,d.cropped_y,d.cropped_width,d.cropped_height);var k=new a.Texture(i);k.needsUpdate=!0,k.minFilter=a.LinearFilter,k.generateMipmaps=!1,e.resolve(k)},j=function(a){if(a.lengthComputable&&g.loader){var b=parseInt(a.loaded/a.total*100);b>h&&(h=b,g.loader.setProgress(h))}},k=function(){g.container.textContent="Cannot load image",e.reject()};return f.load(this.config.panorama,i,j,k),e.promise},c.prototype._setTexture=function(a){return this.scene||this._createScene(),this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.map=a,this.trigger("panorama-loaded"),this.render(),b.resolved()},c.prototype._createScene=function(){this._onResize(),this.raycaster=new a.Raycaster,this.renderer=c.SYSTEM.isWebGLSupported&&this.config.webgl?new a.WebGLRenderer:new a.CanvasRenderer,this.renderer.setSize(this.prop.size.width,this.prop.size.height),this.camera=new a.PerspectiveCamera(this.config.default_fov,this.prop.size.width/this.prop.size.height,1,300),this.camera.position.set(0,0,0),v.checkTHREE("DeviceOrientationControls")&&(this.doControls=new a.DeviceOrientationControls(this.camera)),this.scene=new a.Scene,this.scene.add(this.camera);var b=new a.SphereGeometry(200,32,32,-c.HalfPI),d=new a.MeshBasicMaterial;d.side=a.DoubleSide,this.mesh=new a.Mesh(b,d),this.mesh.scale.x=-1,this.scene.add(this.mesh),this.canvas_container=document.createElement("div"),this.canvas_container.className="canvas-container",this.container.appendChild(this.canvas_container),this.canvas_container.appendChild(this.renderer.domElement),this.config.navbar&&(this.container.classList.add("has-navbar"),this.navbar=new q(this)),this.hud=new o(this),this.config.markers.forEach(function(a){this.hud.addMarker(a,!1)},this),this.panel=new t(this),this.tooltip=new u(this.hud),this.config.time_anim!==!1&&(this.prop.start_timeout=window.setTimeout(this.startAutorotate.bind(this),this.config.time_anim)),this.config.transition&&this.config.transition.blur&&(this.composer=new a.EffectComposer(this.renderer),this.passes.render=new a.RenderPass(this.scene,this.camera),this.passes.copy=new a.ShaderPass(a.CopyShader),this.passes.copy.renderToScreen=!0,this.passes.blur=new a.ShaderPass(a.GodraysShader),this.passes.blur.enabled=!1,this.passes.blur.renderToScreen=!0,this.passes.blur.uniforms.fDensity.value=0,this.passes.blur.uniforms.fWeight.value=.5,this.passes.blur.uniforms.fDecay.value=.5,this.passes.blur.uniforms.fExposure.value=1,this.composer.addPass(this.passes.render),this.composer.addPass(this.passes.copy),this.composer.addPass(this.passes.blur)),this._bindEvents(),this.trigger("ready")},c.prototype._transition=function(b,d){var e=this,f=new a.SphereGeometry(150,32,32,-c.HalfPI),g=new a.MeshBasicMaterial;g.side=a.DoubleSide,g.map=b,g.transparent=!0,g.opacity=0;var h=new a.Mesh(f,g);if(h.scale.x=-1,d){h.rotateY(d.longitude-this.prop.longitude);var i=new a.Vector3(0,1,0).cross(this.camera.getWorldDirection()).normalize(),j=(new a.Quaternion).setFromAxisAngle(i,d.latitude-this.prop.latitude);h.quaternion.multiplyQuaternions(j,h.quaternion)}this.scene.add(h),this.render();var k=this.prop.zoom_lvl;this.config.transition.blur&&(this.passes.copy.enabled=!1,this.passes.blur.enabled=!0);var l=function(a){g.opacity=a.opacity,e.config.transition.blur&&(e.passes.blur.uniforms.fDensity.value=a.density,e.prop.zoom_lvl=a.zoom),e.render()};return v.animation({properties:{density:{start:0,end:1.5},opacity:{start:0,end:.5},zoom:{start:k,end:100}},duration:e.config.transition.duration/(e.config.transition.blur?4/3:2),easing:e.config.transition.blur?"outCubic":"linear",onTick:l}).then(function(){return v.animation({properties:{density:{start:1.5,end:0},opacity:{start:.5,end:1},zoom:{start:100,end:k}},duration:e.config.transition.duration/(e.config.transition.blur?4:2),easing:e.config.transition.blur?"inCubic":"linear",onTick:l})}).then(function(){e.config.transition.blur&&(e.passes.copy.enabled=!0,e.passes.blur.enabled=!1,e.prop.zoom_lvl=k),e.mesh.material.map.dispose(),e.mesh.material.map=b,e.scene.remove(h),h.geometry.dispose(),h.geometry=null,h.material.dispose(),h.material=null,d?e.rotate(d):e.render()})},c.prototype._bindEvents=function(){window.addEventListener("resize",this),document.addEventListener(c.SYSTEM.fullscreenEvent,this),this.config.mousemove&&(this.hud.container.style.cursor="move",this.hud.container.addEventListener("mousedown",this),this.hud.container.addEventListener("touchstart",this),window.addEventListener("mouseup",this),window.addEventListener("touchend",this),this.hud.container.addEventListener("mousemove",this),this.hud.container.addEventListener("touchmove",this)),this.config.mousewheel&&this.hud.container.addEventListener(c.SYSTEM.mouseWheelEvent,this)},c.prototype.handleEvent=function(a){switch(a.type){case"resize":v.throttle(this._onResize(),50);break;case"mousedown":this._onMouseDown(a);break;case"touchstart":this._onTouchStart(a);break;case"mouseup":this._onMouseUp(a);break;case"touchend":this._onTouchEnd(a);break;case"mousemove":this._onMouseMove(a);break;case"touchmove":this._onTouchMove(a);break;case c.SYSTEM.fullscreenEvent:this._fullscreenToggled();break;case c.SYSTEM.mouseWheelEvent:this._onMouseWheel(a)}},c.prototype._onResize=function(){this.container.clientWidth==this.prop.size.width&&this.container.clientHeight==this.prop.size.height||(this.prop.size.width=parseInt(this.container.clientWidth),this.prop.size.height=parseInt(this.container.clientHeight),this.prop.boundingRect=this.container.getBoundingClientRect(),this.camera&&(this.camera.aspect=this.prop.size.width/this.prop.size.height),this.renderer&&(this.renderer.setSize(this.prop.size.width,this.prop.size.height),this.composer&&this.composer.reset(new a.WebGLRenderTarget(this.prop.size.width,this.prop.size.height)),this.render()),this.trigger("size-updated",{width:this.prop.size.width,height:this.prop.size.height}))},c.prototype._onMouseDown=function(a){this._startMove(a)},c.prototype._onTouchStart=function(a){1===a.touches.length?this._startMove(a.touches[0]):2===a.touches.length&&this._startZoom(a)},c.prototype._startMove=function(a){if(!this.prop.orientation_reqid&&!this.prop.autorotate_reqid){if(this.prop.editMode)return this._addMarker(event),void this.ToggleEditMode();this.stopAll(),this.prop.mouse_x=this.prop.start_mouse_x=parseInt(a.clientX),this.prop.mouse_y=this.prop.start_mouse_y=parseInt(a.clientY),this.prop.moving=!0,this.prop.zooming=!1,this.prop.mouse_history.length=0,this._logMouseMove(a)}},c.prototype._startZoom=function(a){var b=[{x:parseInt(a.touches[0].clientX),y:parseInt(a.touches[0].clientY)},{x:parseInt(a.touches[1].clientX),y:parseInt(a.touches[1].clientY)}];this.prop.pinch_dist=Math.sqrt(Math.pow(b[0].x-b[1].x,2)+Math.pow(b[0].y-b[1].y,2)),this.prop.moving=!1,this.prop.zooming=!0},c.prototype._onMouseUp=function(a){this._stopMove(a)},c.prototype._onTouchEnd=function(a){this._stopMove(a.changedTouches[0])},c.prototype._stopMove=function(a){this.prop.moving&&(Math.abs(a.clientX-this.prop.start_mouse_x)<c.MOVE_THRESHOLD&&Math.abs(a.clientY-this.prop.start_mouse_y)<c.MOVE_THRESHOLD?(this._click(a),this.prop.moving=!1):this.config.move_inertia?(this._logMouseMove(a),this._stopMoveInertia(a)):this.prop.moving=!1),this.prop.mouse_history.length=0,this.prop.zooming=!1},c.prototype._stopMoveInertia=function(a){var b=this,d={x:a.clientX-this.prop.mouse_history[0][1],y:a.clientY-this.prop.mouse_history[0][2]},e=Math.sqrt(d.x*d.x+d.y*d.y);this.prop.animation_promise=v.animation({properties:{clientX:{start:a.clientX,end:a.clientX+d.x},clientY:{start:a.clientY,end:a.clientY+d.y}},duration:e*c.INERTIA_WINDOW/100,easing:"outCirc",onTick:function(a){b._move(a)},onCancel:function(){b.prop.moving=!1}}),this.prop.animation_promise.then(function(){b.prop.moving=!1})},c.prototype._click=function(b){if(this.trigger("_click",b),!b.defaultPrevented){var c={client_x:parseInt(b.clientX-this.prop.boundingRect.left),client_y:parseInt(b.clientY-this.prop.boundingRect.top)};b.data&&(c=v.deepmerge(c,b.data));var d=new a.Vector2(2*c.client_x/this.prop.size.width-1,-2*c.client_y/this.prop.size.height+1);this.raycaster.setFromCamera(d,this.camera);var e=this.raycaster.intersectObjects(this.scene.children);if(1===e.length){var f=this.vector3ToSphericalCoords(e[0].point);c.longitude=f.longitude,c.latitude=f.latitude;var g=this.sphericalCoordsToTextureCoords(c.longitude,c.latitude);c.texture_x=g.x,c.texture_y=g.y,this.trigger("click",c)}}},c.prototype._onMouseMove=function(a){0!==a.buttons&&(a.preventDefault(),this._move(a))},c.prototype._onTouchMove=function(a){1===a.touches.length?(a.preventDefault(),this._move(a.touches[0])):2===a.touches.length&&(a.preventDefault(),this._zoom(a))},c.prototype._move=function(a){if(this.prop.moving){var b=parseInt(a.clientX),c=parseInt(a.clientY);this.rotate({longitude:this.prop.longitude-(b-this.prop.mouse_x)*this.config.long_offset,latitude:this.prop.latitude+(c-this.prop.mouse_y)*this.config.lat_offset}),this.prop.mouse_x=b,this.prop.mouse_y=c,this._logMouseMove(a)}},c.prototype._zoom=function(a){if(this.prop.zooming){var b=[{x:parseInt(a.touches[0].clientX),y:parseInt(a.touches[0].clientY)},{x:parseInt(a.touches[1].clientX),y:parseInt(a.touches[1].clientY)}],c=Math.sqrt(Math.pow(b[0].x-b[1].x,2)+Math.pow(b[0].y-b[1].y,2)),d=80*(c-this.prop.pinch_dist)/this.prop.size.width;this.zoom(this.prop.zoom_lvl+d),this.prop.pinch_dist=c}},c.prototype._onMouseWheel=function(a){a.preventDefault(),a.stopPropagation();var b=void 0!==a.deltaY?-a.deltaY:void 0!==a.wheelDelta?a.wheelDelta:-a.detail;if(0!==b){var c=parseInt(b/Math.abs(b));this.zoom(this.prop.zoom_lvl+c)}},c.prototype._fullscreenToggled=function(){this.trigger("fullscreen-updated",v.isFullscreenEnabled())},c.prototype._logMouseMove=function(a){var b=Date.now();this.prop.mouse_history.push([b,a.clientX,a.clientY]);for(var d=null,e=0;e<this.prop.mouse_history.length;)this.prop.mouse_history[0][e]<b-c.INERTIA_WINDOW?this.prop.mouse_history.splice(e,1):d&&this.prop.mouse_history[0][e]-d>c.INERTIA_WINDOW/10?(this.prop.mouse_history.splice(0,e),e=0,d=this.prop.mouse_history[0][e]):(e++,d=this.prop.mouse_history[0][e])},c.prototype._translateClientPosToTexturePos=function(b){var c={client_x:parseInt(b.clientX-this.prop.boundingRect.left),client_y:parseInt(b.clientY-this.prop.boundingRect.top)};b.data&&(c=v.deepmerge(c,b.data));var d=new a.Vector2(2*c.client_x/this.prop.size.width-1,-2*c.client_y/this.prop.size.height+1);this.raycaster.setFromCamera(d,this.camera);var e=this.raycaster.intersectObjects(this.scene.children);if(1===e.length){var f=this.vector3ToSphericalCoords(e[0].point);c.longitude=f.longitude,c.latitude=f.latitude;var g=this.sphericalCoordsToTextureCoords(c.longitude,c.latitude);return c.texture_x=g.x,c.texture_y=g.y,c}},c.prototype._addMarker=function(a){var b=this._translateClientPosToTexturePos(a),c={id:Date.now(),name:"Marker bez nazwy",tooltip:"Marker bez nazwy",content:"",x:b.texture_x,y:b.texture_y,html:'<i class="material-icons marker" style="color:black;font-size:64px;" aria-hidden="true">details</i>',markerIcon:"details",markerColor:"black",markerSize:"64",width:32,height:32,anchor:"bottom center"},c=this.addMarker(c,!0);this.trigger("newMarker",c)},c.prototype.load=function(){this.setPanorama(this.config.panorama,!1)},c.prototype.render=function(a){a!==!1&&(this.prop.direction=this.sphericalCoordsToVector3(this.prop.longitude,this.prop.latitude),this.camera.lookAt(this.prop.direction),this.camera.rotation.z=0),this.camera.fov=this.config.max_fov+this.prop.zoom_lvl/100*(this.config.min_fov-this.config.max_fov),this.camera.updateProjectionMatrix(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.trigger("render")},c.prototype.destroy=function(){window.removeEventListener("resize",this),document.removeEventListener(c.SYSTEM.fullscreenEvent,this),this.config.mousemove&&(this.hud.container.removeEventListener("mousedown",this),this.hud.container.removeEventListener("touchstart",this),window.removeEventListener("mouseup",this),window.removeEventListener("touchend",this),this.hud.container.removeEventListener("mousemove",this),this.hud.container.removeEventListener("touchmove",this)),this.config.mousewheel&&this.hud.container.removeEventListener(c.SYSTEM.mouseWheelEvent,this),this.hud&&this.hud.destroy(),this.loader&&this.loader.destroy(),this.navbar&&this.navbar.destroy(),this.panel&&this.panel.destroy(),this.tooltip&&this.tooltip.destroy(),this.doControls&&this.doControls.disconnect(),this.scene&&(this.scene.remove(this.camera),this.scene.remove(this.mesh)),this.mesh&&(this.mesh.material.geometry.dispose(),this.mesh.material.geometry=null,this.mesh.material.map.dispose(),this.mesh.material.map=null,this.mesh.material.dispose(),this.mesh.material=null),this.canvas_container&&this.container.removeChild(this.canvas_container),this.parent.removeChild(this.container),this.container=null,this.loader=null,this.navbar=null,this.hud=null,this.panel=null,this.tooltip=null,this.canvas_container=null,this.renderer=null,this.composer=null,this.scene=null,this.camera=null,this.mesh=null,this.raycaster=null,this.passes={},this.actions={}},c.prototype.setPanorama=function(a,b,c){"boolean"==typeof b&&(c=b,b=void 0),b&&(this._cleanPosition(b),this.stopAll()),this.config.panorama=a;var d=this;return c&&this.config.transition&&this.scene?(this.config.transition.loader&&(this.loader=new p(this)),this._loadXMP().then(this._loadTexture.bind(this)).then(function(a){return d.loader&&(d.loader.destroy(),d.loader=null),d._transition(a,b)})):(this.loader=new p(this),this._loadXMP().then(this._loadTexture.bind(this)).then(this._setTexture.bind(this)).then(function(){d.loader&&(d.loader.destroy(),d.loader=null),b?d.rotate(b):d.render()}))},c.prototype.stopAll=function(){this.stopAutorotate(),this.stopAnimation(),this.stopGyroscopeControl()},c.prototype.startAutorotate=function(){this.stopAll();var a=this,b=null,c=null;!function d(e){e&&(c=null===b?0:e-b,b=e,a.rotate({longitude:a.prop.longitude+a.prop.anim_speed*c/1e3,latitude:a.prop.latitude-(a.prop.latitude-a.config.anim_lat)/200})),a.prop.autorotate_reqid=window.requestAnimationFrame(d)}(null),this.trigger("autorotate",!0)},c.prototype.stopAutorotate=function(){this.prop.start_timeout&&(window.clearTimeout(this.prop.start_timeout),this.prop.start_timeout=null),this.prop.autorotate_reqid&&(window.cancelAnimationFrame(this.prop.autorotate_reqid),this.prop.autorotate_reqid=null,this.trigger("autorotate",!1))},c.prototype.toggleAutorotate=function(){this.prop.autorotate_reqid?this.stopAutorotate():this.startAutorotate()},c.prototype.startGyroscopeControl=function(){this.stopAll();var a=this;!function b(){a.doControls.update(),a.prop.direction=a.camera.getWorldDirection();var c=a.vector3ToSphericalCoords(a.prop.direction);a.prop.longitude=c.longitude,a.prop.latitude=c.latitude,a.render(!1),a.prop.orientation_reqid=window.requestAnimationFrame(b)}(),this.trigger("gyroscope-updated",!0)},c.prototype.stopGyroscopeControl=function(){this.prop.orientation_reqid&&(window.cancelAnimationFrame(this.prop.orientation_reqid),this.prop.orientation_reqid=null,this.trigger("gyroscope-updated",!1),this.render())},c.prototype.toggleGyroscopeControl=function(){this.prop.orientation_reqid?this.stopGyroscopeControl():this.startGyroscopeControl()},c.prototype.rotate=function(a){this._cleanPosition(a),this.prop.longitude=a.longitude,this.prop.latitude=a.latitude,this.renderer&&this.render(),this.trigger("position-updated",{longitude:this.prop.longitude,latitude:this.prop.latitude})},c.prototype.animate=function(a,b){if(this.stopAll(),!b)return void this.rotate(a);if(this._cleanPosition(a),!b&&"number"!=typeof b){b=b?this._parseAnimSpeed(b):this.prop.anim_speed;var d=Math.acos(Math.cos(this.prop.latitude)*Math.cos(a.latitude)*Math.cos(this.prop.longitude-a.longitude)+Math.sin(this.prop.latitude)*Math.sin(a.latitude));b=d/b*1e3}var e=[0,c.TwoPI,-c.TwoPI],f=e.reduce(function(b,c){return c=a.longitude-this.prop.longitude+c,Math.abs(c)<Math.abs(b)?c:b}.bind(this),1/0);this.prop.animation_promise=v.animation({properties:{longitude:{start:this.prop.longitude,end:this.prop.longitude+f},latitude:{start:this.prop.latitude,end:a.latitude}},duration:b,easing:"inOutSine",onTick:this.rotate.bind(this)})},c.prototype.stopAnimation=function(){this.prop.animation_promise&&(this.prop.animation_promise.cancel(),this.prop.animation_promise=null)},c.prototype.zoom=function(a){this.prop.zoom_lvl=v.stayBetween(Math.round(a),0,100),this.render(),this.trigger("zoom-updated",this.prop.zoom_lvl)},c.prototype.zoomIn=function(){this.prop.zoom_lvl<100&&this.zoom(this.prop.zoom_lvl+1)},c.prototype.zoomOut=function(){this.prop.zoom_lvl>0&&this.zoom(this.prop.zoom_lvl-1)},c.prototype.toggleFullscreen=function(){v.isFullscreenEnabled()?v.exitFullscreen():v.requestFullscreen(this.container)},c.prototype.setAnimSpeed=function(a){this.prop.anim_speed=this._parseAnimSpeed(a)},c.prototype.on=function(a,b){return a in this.actions||(this.actions[a]=[]),this.actions[a].push(b),this},c.prototype.off=function(a,b){if(a in this.actions){var c=this.actions[a].indexOf(b);-1!==c&&this.actions[a].splice(c,1);
}return this},c.prototype.ToggleEditMode=function(){this.prop.editMode?this.hud.container.style.cursor="move":this.hud.container.style.cursor="crosshair",this.prop.editMode=!this.prop.editMode},c.prototype._rotateLeft=function(){this.animate({longitude:this.prop.longitude-.7,latitude:this.prop.latitude},300)},c.prototype._rotateRight=function(){this.animate({longitude:this.prop.longitude+.7,latitude:this.prop.latitude},300)},c.prototype._rotateDown=function(){this.animate({longitude:this.prop.longitude,latitude:this.prop.latitude-.7},300)},c.prototype._rotateUp=function(){this.animate({longitude:this.prop.longitude,latitude:this.prop.latitude+.7},300)},c.prototype.trigger=function(a,b){b=Array.prototype.slice.call(arguments,1),a in this.actions&&this.actions[a].length>0&&this.actions[a].forEach(function(c){"object"==typeof c?c.handleEvent({type:"psv:"+a,args:b}):c.apply(this,b)},this)},c.loadSystem=function(){var a=c.SYSTEM;a.loaded=!0,a.isWebGLSupported=v.isWebGLSupported(),a.isCanvasSupported=v.isCanvasSupported(),a.maxTextureWidth=v.getMaxTextureWidth(),a.mouseWheelEvent=v.mouseWheelEvent(),a.fullscreenEvent=v.fullscreenEvent(),a.deviceOrientationSupported=b(),window.addEventListener("deviceorientation",c.deviceOrientationListener,!1)},c.deviceOrientationListener=function(a){null!==a.alpha?c.SYSTEM.deviceOrientationSupported.resolve():c.SYSTEM.deviceOrientationSupported.reject(),window.removeEventListener("deviceorientation",c.deviceOrientationListener)},c.prototype._parseAnimSpeed=function(a){a=a.toString().trim();var b=parseFloat(a.replace(/^(-?[0-9]+(?:\.[0-9]*)?).*$/,"$1")),d=a.replace(/^-?[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim();d.match(/(pm|per minute)$/)&&(b/=60);var e=0;switch(d){case"dpm":case"degrees per minute":case"dps":case"degrees per second":e=b*Math.PI/180;break;case"radians per minute":case"radians per second":e=b;break;case"rpm":case"revolutions per minute":case"rps":case"revolutions per second":e=b*c.TwoPI;break;default:throw new f('unknown speed unit "'+d+'"')}return e},c.prototype._setViewerSize=function(a){["width","height"].forEach(function(b){a[b]&&(/^[0-9.]+$/.test(a[b])&&(a[b]+="px"),this.parent.style[b]=a[b])},this)},c.prototype.textureCoordsToSphericalCoords=function(a,b){var d=a/this.prop.image_size.original_width*c.TwoPI,e=b/this.prop.image_size.original_height*c.PI;return{longitude:d>=c.PI?d-c.PI:d+c.PI,latitude:c.HalfPI-e}},c.prototype.sphericalCoordsToTextureCoords=function(a,b){var d=a/c.TwoPI*this.prop.image_size.original_width,e=b/c.PI*this.prop.image_size.original_height;return{x:parseInt(a<c.PI?d+this.prop.image_size.original_width/2:d-this.prop.image_size.original_width/2),y:parseInt(this.prop.image_size.original_height/2-e)}},c.prototype.sphericalCoordsToVector3=function(b,c){return new a.Vector3(-Math.cos(c)*Math.sin(b),Math.sin(c),Math.cos(c)*Math.cos(b))},c.prototype.vector3ToSphericalCoords=function(a){var b=Math.acos(a.y/Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)),d=Math.atan2(a.x,a.z);return{longitude:0>d?-d:c.TwoPI-d,latitude:c.HalfPI-b}},c.prototype._cleanPosition=function(a){if(a.hasOwnProperty("x")&&a.hasOwnProperty("y")){var b=this.textureCoordsToSphericalCoords(a.x,a.y);a.longitude=b.longitude,a.latitude=b.latitude}a.longitude=a.longitude-Math.floor(a.longitude/c.TwoPI)*c.TwoPI,a.latitude=v.stayBetween(a.latitude,this.config.tilt_down_max,this.config.tilt_up_max)},g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.className="psv-button hover-scale autorotate-button",g.icon="play.svg",g.iconActive="play-active.svg",g.prototype.create=function(){e.prototype.create.call(this),this.container.title=this.psv.config.lang.autorotate,this.container.addEventListener("click",this.psv.toggleAutorotate.bind(this.psv)),this.psv.on("autorotate",this)},g.prototype.destroy=function(){this.psv.off("autorotate",this),e.prototype.destroy.call(this)},g.prototype.handleEvent=function(a){switch(a.type){case"psv:autorotate":this.toggleActive(a.args[0])}},h.prototype=Object.create(e.prototype),h.prototype.constructor=h,h.className="psv-button hoverable",h.prototype.create=function(){e.prototype.create.call(this),this.config.className&&this.container.classList.add(this.config.className),this.config.title&&(this.container.title=this.config.title),this.config.content&&(this.container.innerHTML=this.config.content),this.config.onClick&&this.container.addEventListener("click",this.config.onClick)},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.className="psv-button hover-scale download-button",i.icon="download.svg",i.prototype.create=function(){e.prototype.create.call(this),this.container.title=this.psv.config.lang.download,this.container.addEventListener("click",this._download.bind(this))},i.prototype._download=function(){var a=document.createElement("a");a.href=this.psv.config.panorama,a.download=this.psv.config.panorama,this.psv.container.appendChild(a),a.click()},j.prototype=Object.create(e.prototype),j.prototype.constructor=j,j.className="psv-button hover-scale fullscreen-button",j.icon="fullscreen-in.svg",j.iconActive="fullscreen-out.svg",j.prototype.create=function(){e.prototype.create.call(this),this.container.title=this.psv.config.lang.fullscreen,this.container.addEventListener("click",this.psv.toggleFullscreen.bind(this.psv)),this.psv.on("fullscreen-updated",this)},j.prototype.destroy=function(){this.psv.off("fullscreen-updated",this),e.prototype.destroy.call(this)},j.prototype.handleEvent=function(a){switch(a.type){case"psv:fullscreen-updated":this.toggleActive(a.args[0])}},k.prototype=Object.create(e.prototype),k.prototype.constructor=k,k.className="psv-button hover-scale gyroscope-button",k.icon="compass.svg",k.prototype.create=function(){e.prototype.create.call(this),this.container.style.display="none",this.container.title=this.psv.config.lang.gyroscope,c.SYSTEM.deviceOrientationSupported.promise.then(this._onAvailabilityChange.bind(this,!0),this._onAvailabilityChange.bind(this,!1)),this.container.addEventListener("click",this.psv.toggleGyroscopeControl.bind(this.psv)),this.psv.on("gyroscope-updated",this)},k.prototype.destroy=function(){this.psv.off("gyroscope-updated",this),e.prototype.destroy.call(this)},k.prototype.handleEvent=function(a){switch(a.type){case"psv:gyroscope-updated":this.toggleActive(a.args[0])}},k.prototype._onAvailabilityChange=function(a){if(a){if(!this.psv.doControls)throw new f("Missing Three.js components: DeviceOrientationControls. Get them from threejs-examples package.");this.container.style.display="block"}else this.destroy()},l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l.className="psv-button hover-scale markers-button",l.icon="pin.svg",l.prototype.create=function(){e.prototype.create.call(this),this.container.title=this.psv.config.lang.markers,this.container.addEventListener("click",this.toggleMarkers.bind(this)),this.psv.on("open-panel",this),this.psv.on("close-panel",this)},l.prototype.destroy=function(){this.psv.off("open-panel",this),this.psv.off("close-panel",this),e.prototype.destroy.call(this)},l.prototype.handleEvent=function(a){switch(a.type){case"psv:open-panel":this._onPanelOpened();break;case"psv:close-panel":this._onPanelClosed()}},l.prototype.toggleMarkers=function(){this.prop.panelOpened?this.hideMarkers():this.showMarkers()},l.prototype.showMarkers=function(){var a='<div class="psv-markers-list"><h1>'+this.psv.config.lang.markers+"</h1><ul>";for(var b in this.psv.hud.markers){var c=this.psv.hud.markers[b],d=c.id;c.html?d=c.html:c.tooltip&&(d="string"==typeof c.tooltip?c.tooltip:c.tooltip.content),a+='<li data-psv-marker="'+c.id+'">',c.image&&(a+='<img class="marker-image" src="'+c.image+'"/>'),a+='<p class="marker-name">'+d+"</p></li>"}a+="</ul></div>",this.prop.panelOpening=!0,this.psv.panel.showPanel(a,!0),this.psv.panel.container.querySelector(".psv-markers-list").addEventListener("click",this._onClickItem.bind(this))},l.prototype.hideMarkers=function(){this.psv.panel.hidePanel()},l.prototype._onClickItem=function(a){var b;a.target&&(b=v.getClosest(a.target,"li"))&&b.dataset.psvMarker&&(this.psv.hud.gotoMarker(b.dataset.psvMarker,1e3),this.psv.panel.hidePanel())},l.prototype._onPanelOpened=function(){this.prop.panelOpening?(this.prop.panelOpening=!1,this.prop.panelOpened=!0):this.prop.panelOpened=!1,this.toggleActive(this.prop.panelOpened)},l.prototype._onPanelClosed=function(){this.prop.panelOpened=!1,this.prop.panelOpening=!1,this.toggleActive(this.prop.panelOpened)},m.prototype=Object.create(e.prototype),m.prototype.constructor=m,m.className="psv-button markers-button",m.prototype.create=function(){e.prototype.create.call(this),this.container.title="Sceny",this.container.innerHTML='<i class="material-icons"  aria-hidden="true">collections</i>',this.container.addEventListener("click",this.toggleScenes.bind(this)),this.psv.on("open-panel",this),this.psv.on("close-panel",this)},m.prototype.destroy=function(){this.psv.off("open-panel",this),this.psv.off("close-panel",this),e.prototype.destroy.call(this)},m.prototype.handleEvent=function(a){switch(a.type){case"psv:open-panel":this._onPanelOpened();break;case"psv:close-panel":this._onPanelClosed()}},m.prototype.toggleScenes=function(){this.prop.panelOpened?this.hideScenes():this.showScenes()},m.prototype.showScenes=function(){var a='<div class="psv-markers-list"><h1>Sceny</h1><ul>';loader.minatureList.forEach(function(b){a+='<li data-psv-marker="'+b.sceneIndex+'">',a+='<img  src="'+b.imgURL+'"/>',a+='<p class="marker-name">'+b.sceneName+"</p></li>"}),a+="</ul></div>",this.prop.panelOpening=!0,this.psv.panel.showPanel(a,!0),this.psv.panel.container.querySelector(".psv-markers-list").addEventListener("click",this._onClickItem.bind(this))},m.prototype.hideScenes=function(){this.psv.panel.hidePanel()},m.prototype._onClickItem=function(a){var b;a.target&&(b=v.getClosest(a.target,"li"))&&b.dataset.psvMarker&&this.psv.trigger("sceneTransition",b.dataset.psvMarker)},m.prototype._onPanelOpened=function(){this.prop.panelOpening?(this.prop.panelOpening=!1,this.prop.panelOpened=!0):this.prop.panelOpened=!1,this.toggleActive(this.prop.panelOpened)},m.prototype._onPanelClosed=function(){this.prop.panelOpened=!1,this.prop.panelOpening=!1,this.toggleActive(this.prop.panelOpened)},n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.className="psv-button zoom-button",n.prototype.create=function(){e.prototype.create.call(this);var a=document.createElement("div");a.className="minus",a.title=this.psv.config.lang.zoomOut,a.innerHTML=c.ICONS["zoom-out.svg"],this.container.appendChild(a);var b=document.createElement("div");b.className="range",this.container.appendChild(b),this.zoom_range=document.createElement("div"),this.zoom_range.className="line",this.zoom_range.title=this.psv.config.lang.zoom,b.appendChild(this.zoom_range),this.zoom_value=document.createElement("div"),this.zoom_value.className="handle",this.zoom_value.title=this.psv.config.lang.zoom,this.zoom_range.appendChild(this.zoom_value);var d=document.createElement("div");d.className="plus",d.title=this.psv.config.lang.zoomIn,d.innerHTML=c.ICONS["zoom-in.svg"],this.container.appendChild(d),this.zoom_range.addEventListener("mousedown",this),this.zoom_range.addEventListener("touchstart",this),this.psv.container.addEventListener("mousemove",this),this.psv.container.addEventListener("touchmove",this),this.psv.container.addEventListener("mouseup",this),this.psv.container.addEventListener("touchend",this),a.addEventListener("mousedown",this._zoomOut.bind(this)),d.addEventListener("mousedown",this._zoomIn.bind(this)),this.psv.on("zoom-updated",this);var f=this;window.setTimeout(function(){f._moveZoomValue(f.psv.prop.zoom_lvl)},0)},n.prototype.destroy=function(){this.psv.container.removeEventListener("mousemove",this),this.psv.container.removeEventListener("touchmove",this),this.psv.container.removeEventListener("mouseup",this),this.psv.container.removeEventListener("touchend",this),this.psv.off("zoom-updated",this),e.prototype.destroy.call(this)},n.prototype.handleEvent=function(a){switch(a.type){case"mousedown":this._initZoomChangeWithMouse(a);break;case"touchstart":this._initZoomChangeByTouch(a);break;case"mousemove":this._changeZoomWithMouse(a);break;case"touchmove":this._changeZoomByTouch(a);break;case"mouseup":this._stopZoomChange(a);break;case"touchend":this._stopZoomChange(a);break;case"psv:zoom-updated":this._moveZoomValue(a.args[0])}},n.prototype._moveZoomValue=function(a){this.zoom_value.style.left=a/100*this.zoom_range.offsetWidth-this.zoom_value.offsetWidth/2+"px"},n.prototype._initZoomChangeWithMouse=function(a){this.prop.mousedown=!0,this._changeZoom(a.clientX)},n.prototype._initZoomChangeByTouch=function(a){this.prop.mousedown=!0,this._changeZoom(a.changedTouches[0].clientX)},n.prototype._zoomIn=function(){this.prop.buttondown=!0,this.psv.zoomIn(),window.setTimeout(this._startLongPressInterval.bind(this,1),200)},n.prototype._zoomOut=function(){this.prop.buttondown=!0,this.psv.zoomOut(),window.setTimeout(this._startLongPressInterval.bind(this,-1),200)},n.prototype._startLongPressInterval=function(a){this.prop.buttondown&&(this.prop.longPressInterval=window.setInterval(function(){this.psv.zoom(this.psv.prop.zoom_lvl+a)}.bind(this),50))},n.prototype._stopZoomChange=function(){window.clearInterval(this.prop.longPressInterval),this.prop.longPressInterval=null,this.prop.mousedown=!1,this.prop.buttondown=!1},n.prototype._changeZoomWithMouse=function(a){a.preventDefault(),this._changeZoom(a.clientX)},n.prototype._changeZoomByTouch=function(a){a.preventDefault(),this._changeZoom(a.changedTouches[0].clientX)},n.prototype._changeZoom=function(a){if(this.prop.mousedown){var b=parseInt(a)-this.zoom_range.getBoundingClientRect().left,c=b/this.zoom_range.offsetWidth*100;this.psv.zoom(c)}},o.prototype=Object.create(d.prototype),o.prototype.constructor=o,o.className="psv-hud",o.publicMethods=["addMarker","removeMarker","updateMarker","getMarker","getCurrentMarker","gotoMarker","hideMarker","showMarker","toggleMarker"],o.svgNS="http://www.w3.org/2000/svg",o.prototype.create=function(){d.prototype.create.call(this),this.$svg=document.createElementNS(o.svgNS,"svg"),this.$svg.setAttribute("class","psv-svg-container"),this.container.appendChild(this.$svg),this.container.addEventListener("mouseenter",this,!0),this.container.addEventListener("mouseleave",this,!0),this.container.addEventListener("mousemove",this,!0),this.psv.on("_click",this),this.psv.on("render",this)},o.prototype.destroy=function(){this.container.removeEventListener("mouseenter",this),this.container.removeEventListener("mouseleave",this),this.container.removeEventListener("mousemove",this),this.psv.off("_click",this),this.psv.off("render",this),this.container.removeChild(this.$svg),this.$svg=null,d.prototype.destroy.call(this)},o.prototype.handleEvent=function(a){switch(a.type){case"mouseenter":this._onMouseEnter(a);break;case"mouseleave":this._onMouseLeave(a);break;case"mousemove":this._onMouseMove(a);break;case"psv:_click":this._onClick(a.args[0]);break;case"psv:render":this.updatePositions()}},o.prototype.addMarker=function(a,b){if(!a.id)throw new f("missing marker id");if(this.markers[a.id])throw new f('marker "'+a.id+'" already exists');if(!(a.image||a.html||a.polygon_px||a.polygon_rad))throw new f("missing marker content, image or html or polygon");if(a.image&&(!a.width||!a.height))throw new f("missing marker width/height");if((a.image||a.html)&&!(a.hasOwnProperty("x")&&a.hasOwnProperty("y")||a.hasOwnProperty("latitude")&&a.hasOwnProperty("longitude")))throw new f("missing marker position, latitude/longitude or x/y");var c={id:a.id,$el:null};return a.image||a.html?(c.$el=document.createElement("div"),c.$el.setAttribute("class","psv-marker"),this.container.appendChild(c.$el)):(c.$el=document.createElementNS(o.svgNS,"polygon"),c.$el.setAttribute("class","psv-marker svg-marker"),this.$svg.appendChild(c.$el)),c.$el.id="psv-marker-"+c.id,this.markers[a.id]=c,this.updateMarker(a,b)},o.prototype.getMarker=function(a){var b="object"==typeof a?a.id:a;if(!this.markers[b])throw new f('cannot find marker "'+b+'"');return this.markers[b]},o.prototype.getCurrentMarker=function(){return this.currentMarker},o.prototype.updateMarker=function(a,b){var c=this.getMarker(a);return c.className&&c.$el.classList.remove(c.className),c.tooltip&&c.$el.classList.remove("has-tooltip"),a==c&&(a=v.clone(a)),delete a.$el,a=v.deepmerge(c,a),a.position2D=null,a.className&&a.$el.classList.add(a.className),a.tooltip&&(a.$el.classList.add("has-tooltip"),"string"==typeof a.tooltip&&(a.tooltip={content:a.tooltip})),a.image||a.html?this._updateNormalMarker(a):this._updatePolygonMarker(a),a.hasOwnProperty("visible")||(a.visible=!0),a.$el.psvMarker=a,this.markers[a.id]=a,b!==!1&&this.updatePositions(),a},o.prototype._updateNormalMarker=function(a){a.isPolygon=!1;var b=a.$el.style;a.width&&a.height?(b.width=a.width+"px",b.height=a.height+"px",a.dynamicSize=!1):a.dynamicSize=!0,a.style&&Object.getOwnPropertyNames(a.style).forEach(function(c){b[c]=a.style[c]}),a.image?b.backgroundImage="url("+a.image+")":a.$el.innerHTML=a.html,a.anchor=v.parsePosition(a.anchor),b.transformOrigin=100*a.anchor.left+"% "+100*a.anchor.top+"%",this.psv._cleanPosition(a),a.position3D=this.psv.sphericalCoordsToVector3(a.longitude,a.latitude)},o.prototype._updatePolygonMarker=function(a){a.isPolygon=!0,a.dynamicSize=!0,a.style?Object.getOwnPropertyNames(a.style).forEach(function(b){a.$el.setAttribute(b,a.style[b])}):a.$el.setAttribute("fill","rgba(0,0,0,0.5)"),[a.polygon_rad,a.polygon_px].forEach(function(a){if(a&&"object"!=typeof a[0])for(var b=0;b<a.length;b++)a.splice(b,2,[a[b],a[b+1]])}),a.polygon_px&&(a.polygon_rad=a.polygon_px.map(function(a){var b=this.psv.textureCoordsToSphericalCoords(a[0],a[1]);return[b.longitude,b.latitude]},this)),a.longitude=a.polygon_rad[0][0],a.latitude=a.polygon_rad[0][1],a.positions3D=a.polygon_rad.map(function(a){return this.psv.sphericalCoordsToVector3(a[0],a[1])},this)},o.prototype.removeMarker=function(a,b){a=this.getMarker(a),a.isPolygon?this.$svg.removeChild(a.$el):this.container.removeChild(a.$el),delete this.markers[a.id],b!==!1&&this.updatePositions()},o.prototype.gotoMarker=function(a,b){a=this.getMarker(a),this.psv.animate(a,b)},o.prototype.hideMarker=function(a){this.getMarker(a).visible=!1,this.updatePositions()},o.prototype.showMarker=function(a){this.getMarker(a).visible=!0,this.updatePositions()},o.prototype.toggleMarker=function(a){this.getMarker(a).visible^=!0,this.updatePositions()},o.prototype.updatePositions=function(){var a=this.psv.camera.rotation.z/c.PI*180;for(var b in this.markers){var d=this.markers[b];if(d.isPolygon){var e=this._getPolygonPositions(d);if(this._isPolygonVisible(d,e)){d.position2D=this._getPolygonDimensions(e),d.width=d.position2D.width,d.height=d.position2D.height;var f="";e.forEach(function(a){f+=a.left+","+a.top+" "}),d.$el.setAttributeNS(null,"points",f),d.$el.classList.contains("visible")||d.$el.classList.add("visible")}else d.position2D=null,d.$el.classList.remove("visible")}else{var g=this._getMarkerPosition(d);this._isMarkerVisible(d,g)?(d.position2D=g,d.$el.style.transform="translate3D("+g.left+"px, "+g.top+"px, 0px) rotateZ("+a+"deg)",d.$el.classList.contains("visible")||d.$el.classList.add("visible")):(d.position2D=null,d.$el.classList.remove("visible"))}}},o.prototype._isMarkerVisible=function(a,b){return a.visible&&a.position3D.dot(this.psv.prop.direction)>0&&b.left+a.width>=0&&b.left-a.width<=this.psv.prop.size.width&&b.top+a.height>=0&&b.top-a.height<=this.psv.prop.size.height},o.prototype._isPolygonVisible=function(a,b){return a.visible&&b.some(function(b,c){return a.positions3D[c].dot(this.psv.prop.direction)>0&&b.left>=0&&b.left<=this.psv.prop.size.width&&b.top>=0&&b.top<=this.psv.prop.size.height},this)},o.prototype._getMarkerPosition=function(a){if(a.dynamicSize){a.$el.classList.add("transparent");var b=a.$el.getBoundingClientRect();a.$el.classList.remove("transparent"),a.width=b.right-b.left,a.height=b.bottom-b.top}var c=a.position3D.clone();return c.project(this.psv.camera),{top:(1-c.y)/2*this.psv.prop.size.height-a.height*a.anchor.top,left:(c.x+1)/2*this.psv.prop.size.width-a.width*a.anchor.left}},o.prototype._getPolygonPositions=function(a){return a.positions3D.map(function(a){var b=a.clone();return b.project(this.psv.camera),{top:(1-b.y)/2*this.psv.prop.size.height,left:(b.x+1)/2*this.psv.prop.size.width}},this)},o.prototype._getPolygonDimensions=function(a){var b=+(1/0),c=+(1/0),d=-(1/0),e=-(1/0);return a.forEach(function(a){b=Math.min(b,a.left),c=Math.min(c,a.top),d=Math.max(d,a.left),e=Math.max(e,a.top)}),{top:c,left:b,width:d-b,height:e-c}},o.prototype._onMouseEnter=function(a){var b;a.target&&void 0!==(b=a.target.psvMarker)&&b.tooltip&&!b.isPolygon&&(this.hoveringMarker=b,this.psv.tooltip.showTooltip({content:b.tooltip.content,position:b.tooltip.position,top:b.position2D.top,left:b.position2D.left,marker:b}))},o.prototype._onMouseLeave=function(a){if(a.target&&a.target.psvMarker){if(a.target.psvMarker.isPolygon&&a.relatedTarget&&v.hasParent(a.relatedTarget,this.psv.tooltip.container))return;this.hoveringMarker=null,this.psv.tooltip.hideTooltip()}},o.prototype._onMouseMove=function(a){if(!this.psv.prop.moving){var b;a.target&&(b=a.target.psvMarker)&&b.tooltip&&b.isPolygon||a.target&&v.hasParent(a.target,this.psv.tooltip.container)&&(b=this.hoveringMarker)?(this.hoveringMarker=b,this.psv.tooltip.showTooltip({content:b.tooltip.content,position:b.tooltip.position,top:a.clientY-this.psv.prop.boundingRect.top-this.psv.config.tooltip.arrow_size,left:a.clientX-this.psv.prop.boundingRect.left-this.psv.config.tooltip.arrow_size,marker:{width:2*this.psv.config.tooltip.arrow_size,height:2*this.psv.config.tooltip.arrow_size}})):this.hoveringMarker&&this.hoveringMarker.isPolygon&&this.psv.tooltip.hideTooltip()}},o.prototype._onClick=function(a){var b;if(a.target&&(b=v.getClosest(a.target,".psv-marker"))&&b.psvMarker?(this.currentMarker=b.psvMarker,this.psv.trigger("select-marker",b.psvMarker),this.psv.config.click_event_on_marker?a.data={marker:b.psvMarker}:a.preventDefault()):this.currentMarker&&(this.currentMarker=null,this.psv.trigger("unselect-marker")),b&&b.psvMarker)switch(b.psvMarker.type){case"1":this.psv.panel.showPanel(b.psvMarker.content);break;case"2":this.psv.trigger("sceneTransition",b.psvMarker.target_scene);break;case"3":window.open(b.psvMarker.link);break;case"4":this.psv.trigger("onMarkerChangeSpot",{spotId:b.psvMarker.spotId,sceneIndex:b.psvMarker.sceneIndex});break;default:this.psv.panel.showPanel(b.psvMarker.content)}else this.psv.panel.prop.opened&&(a.preventDefault(),this.psv.panel.hidePanel())},p.prototype=Object.create(d.prototype),p.prototype.constructor=p,p.className="loader-container",p.prototype.create=function(){d.prototype.create.call(this),this.loader=document.createElement("div"),this.loader.className="psv-loader",this.container.appendChild(this.loader),this.canvas=document.createElement("canvas"),this.canvas.className="loader-canvas",this.canvas.width=this.loader.clientWidth,this.canvas.height=this.loader.clientWidth,this.loader.appendChild(this.canvas),this.tickness=(this.loader.offsetWidth-this.loader.clientWidth)/2;var a;if(this.psv.config.loading_img?(a=document.createElement("img"),a.className="loader-image",a.src=this.psv.config.loading_img):this.psv.config.loading_txt&&(a=document.createElement("div"),a.className="loader-text",a.innerHTML=this.psv.config.loading_txt),a){var b=Math.round(Math.sqrt(2*Math.pow(this.canvas.width/2-this.tickness/2,2)));a.style.maxWidth=b+"px",a.style.maxHeight=b+"px",this.loader.appendChild(a)}},p.prototype.setProgress=function(a){var b=this.canvas.getContext("2d");b.clearRect(0,0,this.canvas.width,this.canvas.height),b.lineWidth=this.tickness,b.strokeStyle=v.getStyle(this.loader,"color"),b.beginPath(),b.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2-this.tickness/2,-Math.PI/2,a/100*2*Math.PI-Math.PI/2),b.stroke()},q.prototype=Object.create(d.prototype),q.prototype.constructor=q,q.className="psv-navbar",q.prototype.create=function(){d.prototype.create.call(this),this.config.forEach(function(a){if("object"==typeof a)this.items.push(new h(this,a));else switch(a){case"autorotate":this.items.push(new g(this));break;case"zoom":this.items.push(new n(this));break;case"download":this.items.push(new i(this));break;case"markers":this.items.push(new l(this));break;case"fullscreen":this.items.push(new j(this));break;case"gyroscope":this.items.push(new k(this));break;case"caption":this.items.push(new r(this,this.psv.config.caption));break;case"scenes":this.items.push(new m(this));break;case"spacer":a="spacer-5";default:var b=a.match(/spacer\-([0-9]+)/);if(null===b)throw new f("Unknown button "+a);this.items.push(new s(this,b[1]))}},this)},q.prototype.destroy=function(){this.items.forEach(function(a){a.destroy()}),this.items.length=0,d.prototype.destroy.call(this)},r.prototype=Object.create(d.prototype),r.prototype.constructor=r,r.className="psv-caption",r.publicMethods=["setCaption"],r.prototype.setCaption=function(a){a?this.container.innerHTML=a:this.container.innerHTML=""},s.prototype=Object.create(d.prototype),s.prototype.constructor=s,s.className="psv-spacer",t.prototype=Object.create(d.prototype),t.prototype.constructor=t,t.className="psv-panel",t.publicMethods=["showPanel","hidePanel"],t.prototype.create=function(){d.prototype.create.call(this),this.container.innerHTML='<div class="resizer"></div><div class="close-button"></div><div class="content"></div>',this.content=this.container.querySelector(".content");var a=this.container.querySelector(".close-button");a.addEventListener("click",this.hidePanel.bind(this)),this.psv.config.mousewheel&&this.container.addEventListener(c.SYSTEM.mouseWheelEvent,function(a){a.stopPropagation()});var b=this.container.querySelector(".resizer");b.addEventListener("mousedown",this),b.addEventListener("touchstart",this),this.psv.container.addEventListener("mouseup",this),this.psv.container.addEventListener("touchend",this),this.psv.container.addEventListener("mousemove",this),this.psv.container.addEventListener("touchmove",this)},t.prototype.destroy=function(){this.psv.container.removeEventListener("mousemove",this),this.psv.container.removeEventListener("touchmove",this),this.psv.container.removeEventListener("mouseup",this),this.psv.container.removeEventListener("touchend",this),d.prototype.destroy.call(this)},t.prototype.handleEvent=function(a){switch(a.type){case"mousedown":this._onMouseDown(a);break;case"touchstart":this._onTouchStart(a);break;case"mousemove":this._onMouseMove(a);break;case"touchmove":this._onTouchMove(a);break;case"mouseup":this._onMouseUp(a);break;case"touchend":this._onMouseUp(a)}},t.prototype.showPanel=function(a,b){this.content.innerHTML=a,this.content.scrollTop=0,this.container.classList.add("open"),b?this.content.classList.contains("no-margin")||this.content.classList.add("no-margin"):this.content.classList.remove("no-margin"),this.prop.opened=!0,this.psv.trigger("open-panel")},t.prototype.hidePanel=function(){this.prop.opened=!1,this.container.classList.remove("open"),this.psv.trigger("close-panel")},t.prototype._onMouseDown=function(a){a.stopPropagation(),this._startResize(a)},t.prototype._onTouchStart=function(a){a.stopPropagation(),this._startResize(a.changedTouches[0])},t.prototype._startResize=function(a){this.prop.mouse_x=parseInt(a.clientX),this.prop.mouse_y=parseInt(a.clientY),this.prop.mousedown=!0,this.content.classList.add("no-interaction")},t.prototype._onMouseUp=function(a){this.prop.mousedown&&(a.stopPropagation(),this.prop.mousedown=!1,this.content.classList.remove("no-interaction"))},t.prototype._onMouseMove=function(a){this.prop.mousedown&&(a.stopPropagation(),this._resize(a))},t.prototype._onTouchMove=function(a){this.prop.mousedown&&(a.stopPropagation(),this._resize(a.touches[0]))},t.prototype._resize=function(a){var b=parseInt(a.clientX),c=parseInt(a.clientY);this.container.style.width=this.container.offsetWidth-(b-this.prop.mouse_x)+"px",this.prop.mouse_x=b,this.prop.mouse_y=c},u.prototype=Object.create(d.prototype),u.prototype.constructor=u,u.className="psv-tooltip",u.publicMethods=["showTooltip","hideTooltip","isTooltipVisible"],u.leftMap={0:"left",.5:"center",1:"right"},u.topMap={0:"top",.5:"center",1:"bottom"},u.prototype.create=function(){d.prototype.create.call(this),this.container.innerHTML='<div class="arrow"></div><div class="content"></div>',this.container.style.top="-1000px",this.container.style.left="-1000px",this.psv.on("render",this)},u.prototype.destroy=function(){this.psv.off("render",this),d.prototype.destroy.call(this)},u.prototype.handleEvent=function(a){switch(a.type){case"psv:render":this.hideTooltip()}},u.prototype.isTooltipVisible=function(){return this.container.classList.contains("visible")},u.prototype.showTooltip=function(a){var b=this.isTooltipVisible(),c=this.container,d=c.querySelector(".content"),e=c.querySelector(".arrow");if(a.position||(a.position=["top","center"]),a.marker||(a.marker={width:0,height:0}),"string"==typeof a.position){var g=v.parsePosition(a.position);if(!(g.left in u.leftMap&&g.top in u.topMap))throw new f('unable to parse tooltip position "'+tooltip.position+'"');a.position=[u.topMap[g.top],u.leftMap[g.left]]}if("center"==a.position[0]&&"center"==a.position[1])throw new f('unable to parse tooltip position "center center"');if(b)for(var h=c.classList.length-1;h>=0;h--){var i=c.classList.item(h);"psv-tooltip"!=i&&"visible"!=i&&c.classList.remove(i)}else c.className="psv-tooltip",a.className&&c.classList.add(a.className);d.innerHTML=a.content,c.style.top="0px",c.style.left="0px";var j=c.getBoundingClientRect(),k={posClass:a.position.slice(),width:j.right-j.left,height:j.bottom-j.top,top:0,left:0,arrow_top:0,arrow_left:0};this._computeTooltipPosition(k,a);var l=!1;if(k.top<this.config.offset?(k.posClass[0]="bottom",l=!0):k.top+k.height>this.psv.prop.size.height-this.config.offset&&(k.posClass[0]="top",l=!0),k.left<this.config.offset?(k.posClass[1]="right",l=!0):k.left+k.width>this.psv.prop.size.width-this.config.offset&&(k.posClass[1]="left",l=!0),l&&this._computeTooltipPosition(k,a),c.style.top=k.top+"px",c.style.left=k.left+"px",e.style.top=k.arrow_top+"px",e.style.left=k.arrow_left+"px",c.classList.add(k.posClass.join("-")),!b){var m=this;window.setTimeout(function(){c.classList.add("visible"),m.psv.trigger("show-tooltip")},this.config.delay)}},u.prototype.hideTooltip=function(){if(this.isTooltipVisible()){this.container.classList.remove("visible"),this.psv.trigger("hide-tooltip");var a=this;window.setTimeout(function(){a.container.style.top="-1000px",a.container.style.left="-1000px"},this.config.delay)}},u.prototype._computeTooltipPosition=function(a,b){var c=!1;switch(a.posClass[0]){case"bottom":a.top=b.top+b.marker.height+this.config.offset+this.config.arrow_size,a.arrow_top=2*-this.config.arrow_size,c=!0;break;case"center":a.top=b.top+b.marker.height/2-a.height/2,a.arrow_top=a.height/2-this.config.arrow_size;break;case"top":a.top=b.top-a.height-this.config.offset-this.config.arrow_size,a.arrow_top=a.height,c=!0}switch(a.posClass[1]){case"right":c?(a.left=b.left,a.arrow_left=b.marker.width/2-this.config.arrow_size):(a.left=b.left+b.marker.width+this.config.offset+this.config.arrow_size,a.arrow_left=2*-this.config.arrow_size);break;case"center":a.left=b.left+b.marker.width/2-a.width/2,a.arrow_left=a.width/2-this.config.arrow_size;break;case"left":c?(a.left=b.left-a.width+b.marker.width,a.arrow_left=a.width-b.marker.width/2-this.config.arrow_size):(a.left=b.left-a.width-this.config.offset-this.config.arrow_size,a.arrow_left=a.width)}},a.GodraysShader={uniforms:{tDiffuse:{type:"t",value:0,texture:null},fX:{type:"f",value:.5},fY:{type:"f",value:.5},fExposure:{type:"f",value:.6},fDecay:{type:"f",value:.93},fDensity:{type:"f",value:.96},fWeight:{type:"f",value:.4},fClamp:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main()","{","vUv = vec2( uv.x, uv.y );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),
fragmentShader:["varying vec2 vUv;","uniform sampler2D tDiffuse;","uniform float fX;","uniform float fY;","uniform float fExposure;","uniform float fDecay;","uniform float fDensity;","uniform float fWeight;","uniform float fClamp;","const int iSamples = 20;","void main()","{","vec2 deltaTextCoord = vec2(vUv - vec2(fX,fY));","deltaTextCoord *= 1.0 /  float(iSamples) * fDensity;","vec2 coord = vUv;","float illuminationDecay = 1.0;","vec4 FragColor = vec4(0.0);","for(int i=0; i < iSamples ; i++)","{","coord -= deltaTextCoord;","vec4 texel = texture2D(tDiffuse, coord);","texel *= illuminationDecay * fWeight;","FragColor += texel;","illuminationDecay *= fDecay;","}","FragColor *= fExposure;","FragColor = clamp(FragColor, 0.0, fClamp);","gl_FragColor = FragColor;","}"].join("\n")},function(a){if(a.requestAnimationFrame=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,a.cancelAnimationFrame=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,!a.requestAnimationFrame){var b,c=[],d=[],e=0;a.requestAnimationFrame=function(a){return c.push([++e,a]),b||(b=setInterval(function(){if(c.length){var a=+new Date,e=d;for(d=c,c=e;d.length;)d.shift()[1](a)}else clearInterval(b),b=void 0},20)),e},a.cancelAnimationFrame=function(a){var b,e;for(b=0,e=c.length;e>b;b+=1)if(c[b][0]===a)return void c.splice(b,1);for(b=0,e=d.length;e>b;b+=1)if(d[b][0]===a)return void d.splice(b,1)}}}(window),c.ICONS["compass.svg"]='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M49.997,0C22.38,0.004,0.005,22.383,0,50.002C0.005,77.614,22.38,99.995,49.997,100C77.613,99.995,99.996,77.614,100,50.002C99.996,22.383,77.613,0.004,49.997,0z M49.997,88.81c-21.429-0.04-38.772-17.378-38.809-38.807c0.037-21.437,17.381-38.775,38.809-38.812C71.43,11.227,88.769,28.567,88.81,50.002C88.769,71.432,71.43,88.77,49.997,88.81z"/><path d="M72.073,25.891L40.25,41.071l-0.003-0.004l-0.003,0.009L27.925,74.109l31.82-15.182l0.004,0.004l0.002-0.007l-0.002-0.004L72.073,25.891z M57.837,54.411L44.912,42.579l21.092-10.062L57.837,54.411z"/><!--Created by iconoci from the Noun Project--></svg>',c.ICONS["download.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M83.285,35.575H66.271L66.277,3H32.151v32.575H16.561l33.648,32.701L83.285,35.575z"/><path d="M83.316,64.199v16.32H16.592v-16.32H-0.094v32.639H100V64.199H83.316z"/><!--Created by Michael Zenaty from the Noun Project--></svg>',c.ICONS["fullscreen-in.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><polygon points="100,39.925 87.105,39.925 87.105,18.895 66.075,18.895 66.075,6 100,6"/><polygon points="100,93.221 66.075,93.221 66.075,80.326 87.105,80.326 87.105,59.295 100,59.295"/><polygon points="33.925,93.221 0,93.221 0,59.295 12.895,59.295 12.895,80.326 33.925,80.326"/><polygon points="12.895,39.925 0,39.925 0,6 33.925,6 33.925,18.895 12.895,18.895"/><!--Created by Garrett Knoll from the Noun Project--></svg>',c.ICONS["fullscreen-out.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><polygon points="66.075,7 78.969,7 78.969,28.031 100,28.031 100,40.925 66.075,40.925"/><polygon points="66.075,60.295 100,60.295 100,73.19 78.969,73.19 78.969,94.221 66.075,94.221"/><polygon points="0,60.295 33.925,60.295 33.925,94.221 21.031,94.221 21.031,73.19 0,73.19"/><polygon points="21.031,7 33.925,7 33.925,40.925 0,40.925 0,28.031 21.031,28.031"/><!--Created by Garrett Knoll from the Noun Project--></svg>',c.ICONS["pin.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><path d="M24,0C13.798,0,5.499,8.3,5.499,18.501c0,10.065,17.57,28.635,18.318,29.421C23.865,47.972,23.931,48,24,48s0.135-0.028,0.183-0.078c0.748-0.786,18.318-19.355,18.318-29.421C42.501,8.3,34.202,0,24,0z M24,7.139c5.703,0,10.342,4.64,10.342,10.343c0,5.702-4.639,10.342-10.342,10.342c-5.702,0-10.34-4.64-10.34-10.342C13.66,11.778,18.298,7.139,24,7.139z"/><!--Created by Daniele Marucci from the Noun Project--></svg>',c.ICONS["play-active.svg"]='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 41 41" enable-background="new 0 0 41 41" xml:space="preserve"><path d="M40.5,14.1c-0.1-0.1-1.2-0.5-2.898-1C37.5,13.1,37.4,13,37.4,12.9C34.5,6.5,28,2,20.5,2S6.6,6.5,3.7,12.9c0,0.1-0.1,0.1-0.2,0.2c-1.7,0.6-2.8,1-2.9,1L0,14.4v12.1l0.6,0.2c0.1,0,1.1,0.399,2.7,0.899c0.1,0,0.2,0.101,0.2,0.199C6.3,34.4,12.9,39,20.5,39c7.602,0,14.102-4.6,16.9-11.1c0-0.102,0.1-0.102,0.199-0.2c1.699-0.601,2.699-1,2.801-1l0.6-0.3V14.3L40.5,14.1z M6.701,11.5C9.7,7,14.8,4,20.5,4c5.8,0,10.9,3,13.8,7.5c0.2,0.3-0.1,0.6-0.399,0.5c-3.799-1-8.799-2-13.6-2c-4.7,0-9.5,1-13.2,2C6.801,12.1,6.601,11.8,6.701,11.5z M25.1,20.3L18.7,24c-0.3,0.2-0.7,0-0.7-0.5v-7.4c0-0.4,0.4-0.6,0.7-0.4 l6.399,3.8C25.4,19.6,25.4,20.1,25.1,20.3z M34.5,29.201C31.602,33.9,26.4,37,20.5,37c-5.9,0-11.1-3.1-14-7.898c-0.2-0.302,0.1-0.602,0.4-0.5c3.9,1,8.9,2.1,13.6,2.1c5,0,9.9-1,13.602-2C34.4,28.602,34.602,28.9,34.5,29.201z"/><!--Created by Nick Bluth from the Noun Project--></svg>',c.ICONS["play.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 41 41" enable-background="new 0 0 41 41" xml:space="preserve"><path d="M40.5,14.1c-0.1-0.1-1.2-0.5-2.899-1c-0.101,0-0.2-0.1-0.2-0.2C34.5,6.5,28,2,20.5,2S6.6,6.5,3.7,12.9c0,0.1-0.1,0.1-0.2,0.2c-1.7,0.6-2.8,1-2.9,1L0,14.4v12.1l0.6,0.2c0.1,0,1.1,0.4,2.7,0.9c0.1,0,0.2,0.1,0.2,0.199C6.3,34.4,12.9,39,20.5,39c7.601,0,14.101-4.6,16.9-11.1c0-0.101,0.1-0.101,0.2-0.2c1.699-0.6,2.699-1,2.8-1l0.6-0.3V14.3L40.5,14.1zM20.5,4c5.8,0,10.9,3,13.8,7.5c0.2,0.3-0.1,0.6-0.399,0.5c-3.8-1-8.8-2-13.6-2c-4.7,0-9.5,1-13.2,2c-0.3,0.1-0.5-0.2-0.4-0.5C9.7,7,14.8,4,20.5,4z M20.5,37c-5.9,0-11.1-3.1-14-7.899c-0.2-0.301,0.1-0.601,0.4-0.5c3.9,1,8.9,2.1,13.6,2.1c5,0,9.9-1,13.601-2c0.3-0.1,0.5,0.2,0.399,0.5C31.601,33.9,26.4,37,20.5,37z M39.101,24.9c0,0.1-0.101,0.3-0.2,0.3c-2.5,0.9-10.4,3.6-18.4,3.6c-7.1,0-15.6-2.699-18.3-3.6C2.1,25.2,2,25,2,24.9V16c0-0.1,0.1-0.3,0.2-0.3c2.6-0.9,10.6-3.6,18.2-3.6c7.5,0,15.899,2.7,18.5,3.6c0.1,0,0.2,0.2,0.2,0.3V24.9z"/><path d="M18.7,24l6.4-3.7c0.3-0.2,0.3-0.7,0-0.8l-6.4-3.8c-0.3-0.2-0.7,0-0.7,0.4v7.4C18,24,18.4,24.2,18.7,24z"/><!--Created by Nick Bluth from the Noun Project--></svg>',c.ICONS["zoom-in.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M14.043,12.22c2.476-3.483,1.659-8.313-1.823-10.789C8.736-1.044,3.907-0.228,1.431,3.255c-2.475,3.482-1.66,8.312,1.824,10.787c2.684,1.908,6.281,1.908,8.965,0l4.985,4.985c0.503,0.504,1.32,0.504,1.822,0c0.505-0.503,0.505-1.319,0-1.822L14.043,12.22z M7.738,13.263c-3.053,0-5.527-2.475-5.527-5.525c0-3.053,2.475-5.527,5.527-5.527c3.05,0,5.524,2.474,5.524,5.527C13.262,10.789,10.788,13.263,7.738,13.263z"/><polygon points="8.728,4.009 6.744,4.009 6.744,6.746 4.006,6.746 4.006,8.73 6.744,8.73 6.744,11.466 8.728,11.466 8.728,8.73 11.465,8.73 11.465,6.746 8.728,6.746"/><!--Created by Ryan Canning from the Noun Project--></svg>',c.ICONS["zoom-out.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M14.043,12.22c2.476-3.483,1.659-8.313-1.823-10.789C8.736-1.044,3.907-0.228,1.431,3.255c-2.475,3.482-1.66,8.312,1.824,10.787c2.684,1.908,6.281,1.908,8.965,0l4.985,4.985c0.503,0.504,1.32,0.504,1.822,0c0.505-0.503,0.505-1.319,0-1.822L14.043,12.22z M7.738,13.263c-3.053,0-5.527-2.475-5.527-5.525c0-3.053,2.475-5.527,5.527-5.527c3.05,0,5.524,2.474,5.524,5.527C13.262,10.789,10.788,13.263,7.738,13.263z"/><rect x="4.006" y="6.746" width="7.459" height="1.984"/><!--Created by Ryan Canning from the Noun Project--></svg>',c});